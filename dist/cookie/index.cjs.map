{"version":3,"sources":["../../src/cookie/index.ts"],"sourcesContent":["import type { TimeSpan } from \"../index.js\";\n\nexport interface CookieAttributes {\n\tsecure?: boolean;\n\tpath?: string;\n\tdomain?: string;\n\tsameSite?: \"lax\" | \"strict\" | \"none\";\n\thttpOnly?: boolean;\n\tmaxAge?: number;\n\texpires?: Date;\n}\n\nexport function serializeCookie(name: string, value: string, attributes: CookieAttributes): string {\n\tconst keyValueEntries: Array<[string, string] | [string]> = [];\n\tkeyValueEntries.push([encodeURIComponent(name), encodeURIComponent(value)]);\n\tif (attributes?.domain !== undefined) {\n\t\tkeyValueEntries.push([\"Domain\", attributes.domain]);\n\t}\n\tif (attributes?.expires !== undefined) {\n\t\tkeyValueEntries.push([\"Expires\", attributes.expires.toUTCString()]);\n\t}\n\tif (attributes?.httpOnly) {\n\t\tkeyValueEntries.push([\"HttpOnly\"]);\n\t}\n\tif (attributes?.maxAge !== undefined) {\n\t\tkeyValueEntries.push([\"Max-Age\", attributes.maxAge.toString()]);\n\t}\n\tif (attributes?.path !== undefined) {\n\t\tkeyValueEntries.push([\"Path\", attributes.path]);\n\t}\n\tif (attributes?.sameSite === \"lax\") {\n\t\tkeyValueEntries.push([\"SameSite\", \"Lax\"]);\n\t}\n\tif (attributes?.sameSite === \"none\") {\n\t\tkeyValueEntries.push([\"SameSite\", \"None\"]);\n\t}\n\tif (attributes?.sameSite === \"strict\") {\n\t\tkeyValueEntries.push([\"SameSite\", \"Strict\"]);\n\t}\n\tif (attributes?.secure) {\n\t\tkeyValueEntries.push([\"Secure\"]);\n\t}\n\treturn keyValueEntries.map((pair) => pair.join(\"=\")).join(\"; \");\n}\n\nexport function parseCookies(header: string): Map<string, string> {\n\tconst cookies = new Map<string, string>();\n\tconst items = header.split(\"; \");\n\tfor (const item of items) {\n\t\tconst pair = item.split(\"=\");\n\t\tconst rawKey = pair[0];\n\t\tconst rawValue = pair[1] ?? \"\";\n\t\tif (!rawKey) continue;\n\t\tcookies.set(decodeURIComponent(rawKey), decodeURIComponent(rawValue));\n\t}\n\treturn cookies;\n}\n\nexport class CookieController {\n\tconstructor(\n\t\tcookieName: string,\n\t\tbaseCookieAttributes: CookieAttributes,\n\t\tcookieOptions?: {\n\t\t\texpiresIn?: TimeSpan;\n\t\t}\n\t) {\n\t\tthis.cookieName = cookieName;\n\t\tthis.cookieExpiresIn = cookieOptions?.expiresIn ?? null;\n\t\tthis.baseCookieAttributes = baseCookieAttributes;\n\t}\n\n\tpublic cookieName: string;\n\n\tprivate cookieExpiresIn: TimeSpan | null;\n\tprivate baseCookieAttributes: CookieAttributes;\n\n\tpublic createCookie(value: string): Cookie {\n\t\treturn new Cookie(this.cookieName, value, {\n\t\t\t...this.baseCookieAttributes,\n\t\t\tmaxAge: this.cookieExpiresIn?.seconds()\n\t\t});\n\t}\n\n\tpublic createBlankCookie(): Cookie {\n\t\treturn new Cookie(this.cookieName, \"\", {\n\t\t\t...this.baseCookieAttributes,\n\t\t\tmaxAge: 0\n\t\t});\n\t}\n\n\tpublic parse(header: string): string | null {\n\t\tconst cookies = parseCookies(header);\n\t\treturn cookies.get(this.cookieName) ?? null;\n\t}\n}\n\nexport class Cookie {\n\tconstructor(name: string, value: string, attributes: CookieAttributes) {\n\t\tthis.name = name;\n\t\tthis.value = value;\n\t\tthis.attributes = attributes;\n\t}\n\n\tpublic name: string;\n\tpublic value: string;\n\tpublic attributes: CookieAttributes;\n\n\tpublic serialize(): string {\n\t\treturn serializeCookie(this.name, this.value, this.attributes);\n\t}\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYO,SAAS,gBAAgB,MAAc,OAAe,YAAsC;AAClG,QAAM,kBAAsD,CAAC;AAC7D,kBAAgB,KAAK,CAAC,mBAAmB,IAAI,GAAG,mBAAmB,KAAK,CAAC,CAAC;AAC1E,MAAI,YAAY,WAAW,QAAW;AACrC,oBAAgB,KAAK,CAAC,UAAU,WAAW,MAAM,CAAC;AAAA,EACnD;AACA,MAAI,YAAY,YAAY,QAAW;AACtC,oBAAgB,KAAK,CAAC,WAAW,WAAW,QAAQ,YAAY,CAAC,CAAC;AAAA,EACnE;AACA,MAAI,YAAY,UAAU;AACzB,oBAAgB,KAAK,CAAC,UAAU,CAAC;AAAA,EAClC;AACA,MAAI,YAAY,WAAW,QAAW;AACrC,oBAAgB,KAAK,CAAC,WAAW,WAAW,OAAO,SAAS,CAAC,CAAC;AAAA,EAC/D;AACA,MAAI,YAAY,SAAS,QAAW;AACnC,oBAAgB,KAAK,CAAC,QAAQ,WAAW,IAAI,CAAC;AAAA,EAC/C;AACA,MAAI,YAAY,aAAa,OAAO;AACnC,oBAAgB,KAAK,CAAC,YAAY,KAAK,CAAC;AAAA,EACzC;AACA,MAAI,YAAY,aAAa,QAAQ;AACpC,oBAAgB,KAAK,CAAC,YAAY,MAAM,CAAC;AAAA,EAC1C;AACA,MAAI,YAAY,aAAa,UAAU;AACtC,oBAAgB,KAAK,CAAC,YAAY,QAAQ,CAAC;AAAA,EAC5C;AACA,MAAI,YAAY,QAAQ;AACvB,oBAAgB,KAAK,CAAC,QAAQ,CAAC;AAAA,EAChC;AACA,SAAO,gBAAgB,IAAI,CAAC,SAAS,KAAK,KAAK,GAAG,CAAC,EAAE,KAAK,IAAI;AAC/D;AAEO,SAAS,aAAa,QAAqC;AACjE,QAAM,UAAU,oBAAI,IAAoB;AACxC,QAAM,QAAQ,OAAO,MAAM,IAAI;AAC/B,aAAW,QAAQ,OAAO;AACzB,UAAM,OAAO,KAAK,MAAM,GAAG;AAC3B,UAAM,SAAS,KAAK,CAAC;AACrB,UAAM,WAAW,KAAK,CAAC,KAAK;AAC5B,QAAI,CAAC;AAAQ;AACb,YAAQ,IAAI,mBAAmB,MAAM,GAAG,mBAAmB,QAAQ,CAAC;AAAA,EACrE;AACA,SAAO;AACR;AAEO,MAAM,iBAAiB;AAAA,EAC7B,YACC,YACA,sBACA,eAGC;AACD,SAAK,aAAa;AAClB,SAAK,kBAAkB,eAAe,aAAa;AACnD,SAAK,uBAAuB;AAAA,EAC7B;AAAA,EAEO;AAAA,EAEC;AAAA,EACA;AAAA,EAED,aAAa,OAAuB;AAC1C,WAAO,IAAI,OAAO,KAAK,YAAY,OAAO;AAAA,MACzC,GAAG,KAAK;AAAA,MACR,QAAQ,KAAK,iBAAiB,QAAQ;AAAA,IACvC,CAAC;AAAA,EACF;AAAA,EAEO,oBAA4B;AAClC,WAAO,IAAI,OAAO,KAAK,YAAY,IAAI;AAAA,MACtC,GAAG,KAAK;AAAA,MACR,QAAQ;AAAA,IACT,CAAC;AAAA,EACF;AAAA,EAEO,MAAM,QAA+B;AAC3C,UAAM,UAAU,aAAa,MAAM;AACnC,WAAO,QAAQ,IAAI,KAAK,UAAU,KAAK;AAAA,EACxC;AACD;AAEO,MAAM,OAAO;AAAA,EACnB,YAAY,MAAc,OAAe,YAA8B;AACtE,SAAK,OAAO;AACZ,SAAK,QAAQ;AACb,SAAK,aAAa;AAAA,EACnB;AAAA,EAEO;AAAA,EACA;AAAA,EACA;AAAA,EAEA,YAAoB;AAC1B,WAAO,gBAAgB,KAAK,MAAM,KAAK,OAAO,KAAK,UAAU;AAAA,EAC9D;AACD;","names":[]}