{"version":3,"sources":["../../src/crypto/rsa.ts"],"sourcesContent":["import type { TypedArray } from \"../index.js\";\nimport type { KeyPair } from \"./index.js\";\nimport type { SHAHash } from \"./sha.js\";\n\nexport class RSASSAPKCS1v1_5 {\n\tprivate hash: SHAHash;\n\tconstructor(hash: SHAHash) {\n\t\tthis.hash = hash;\n\t}\n\n\tpublic async verify(\n\t\tpublicKey: ArrayBuffer | TypedArray,\n\t\tsignature: ArrayBuffer | TypedArray,\n\t\tdata: ArrayBuffer | TypedArray\n\t): Promise<boolean> {\n\t\tconst cryptoKey = await crypto.subtle.importKey(\n\t\t\t\"spki\",\n\t\t\tpublicKey,\n\t\t\t{\n\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\n\t\t\t\thash: this.hash\n\t\t\t},\n\t\t\tfalse,\n\t\t\t[\"verify\"]\n\t\t);\n\t\treturn await crypto.subtle.verify(\"RSASSA-PKCS1-v1_5\", cryptoKey, signature, data);\n\t}\n\n\tpublic async sign(\n\t\tprivateKey: ArrayBuffer | TypedArray,\n\t\tdata: ArrayBuffer | TypedArray\n\t): Promise<ArrayBuffer> {\n\t\tconst cryptoKey = await crypto.subtle.importKey(\n\t\t\t\"pkcs8\",\n\t\t\tprivateKey,\n\t\t\t{\n\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\n\t\t\t\thash: this.hash\n\t\t\t},\n\t\t\tfalse,\n\t\t\t[\"sign\"]\n\t\t);\n\t\tconst signature = await crypto.subtle.sign(\"RSASSA-PKCS1-v1_5\", cryptoKey, data);\n\t\treturn signature;\n\t}\n\n\tpublic async generateKeyPair(modulusLength?: 2048 | 4096): Promise<KeyPair> {\n\t\tconst cryptoKeyPair = await crypto.subtle.generateKey(\n\t\t\t{\n\t\t\t\tname: \"RSASSA-PKCS1-v1_5\",\n\t\t\t\thash: this.hash,\n\t\t\t\tmodulusLength: modulusLength ?? 2048,\n\t\t\t\tpublicExponent: new Uint8Array([0x01, 0x00, 0x01])\n\t\t\t},\n\t\t\ttrue,\n\t\t\t[\"sign\"]\n\t\t);\n\t\tconst privateKey = await crypto.subtle.exportKey(\"pkcs8\", cryptoKeyPair.privateKey);\n\t\tconst publicKey = await crypto.subtle.exportKey(\"spki\", cryptoKeyPair.publicKey);\n\t\treturn {\n\t\t\tprivateKey,\n\t\t\tpublicKey\n\t\t};\n\t}\n}\n\nexport class RSASSAPSS {\n\tprivate hash: SHAHash;\n\tprivate saltLength: number;\n\tconstructor(hash: SHAHash) {\n\t\tthis.hash = hash;\n\t\tif (hash === \"SHA-1\") {\n\t\t\tthis.saltLength = 20;\n\t\t} else if (hash === \"SHA-256\") {\n\t\t\tthis.saltLength = 32;\n\t\t} else if (hash === \"SHA-384\") {\n\t\t\tthis.saltLength = 48;\n\t\t} else {\n\t\t\tthis.saltLength = 64;\n\t\t}\n\t}\n\n\tpublic async verify(\n\t\tpublicKey: ArrayBuffer | TypedArray,\n\t\tsignature: ArrayBuffer | TypedArray,\n\t\tdata: ArrayBuffer | TypedArray\n\t): Promise<boolean> {\n\t\tconst cryptoKey = await crypto.subtle.importKey(\n\t\t\t\"spki\",\n\t\t\tpublicKey,\n\t\t\t{\n\t\t\t\tname: \"RSA-PSS\",\n\t\t\t\thash: this.hash\n\t\t\t},\n\t\t\tfalse,\n\t\t\t[\"verify\"]\n\t\t);\n\t\treturn await crypto.subtle.verify(\n\t\t\t{\n\t\t\t\tname: \"RSA-PSS\",\n\t\t\t\tsaltLength: this.saltLength\n\t\t\t},\n\t\t\tcryptoKey,\n\t\t\tsignature,\n\t\t\tdata\n\t\t);\n\t}\n\n\tpublic async sign(\n\t\tprivateKey: ArrayBuffer | TypedArray,\n\t\tdata: ArrayBuffer | TypedArray\n\t): Promise<ArrayBuffer> {\n\t\tconst cryptoKey = await crypto.subtle.importKey(\n\t\t\t\"pkcs8\",\n\t\t\tprivateKey,\n\t\t\t{\n\t\t\t\tname: \"RSA-PSS\",\n\t\t\t\thash: this.hash\n\t\t\t},\n\t\t\tfalse,\n\t\t\t[\"sign\"]\n\t\t);\n\t\tconst signature = await crypto.subtle.sign(\n\t\t\t{\n\t\t\t\tname: \"RSA-PSS\",\n\t\t\t\tsaltLength: this.saltLength\n\t\t\t},\n\t\t\tcryptoKey,\n\t\t\tdata\n\t\t);\n\t\treturn signature;\n\t}\n\n\tpublic async generateKeyPair(modulusLength?: 2048 | 4096): Promise<KeyPair> {\n\t\tconst cryptoKeyPair = await crypto.subtle.generateKey(\n\t\t\t{\n\t\t\t\tname: \"RSA-PSS\",\n\t\t\t\thash: this.hash,\n\t\t\t\tmodulusLength: modulusLength ?? 2048,\n\t\t\t\tpublicExponent: new Uint8Array([0x01, 0x00, 0x01])\n\t\t\t},\n\t\t\ttrue,\n\t\t\t[\"sign\"]\n\t\t);\n\t\tconst privateKey = await crypto.subtle.exportKey(\"pkcs8\", cryptoKeyPair.privateKey);\n\t\tconst publicKey = await crypto.subtle.exportKey(\"spki\", cryptoKeyPair.publicKey);\n\t\treturn {\n\t\t\tprivateKey,\n\t\t\tpublicKey\n\t\t};\n\t}\n}\n"],"mappings":"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","names":[]}